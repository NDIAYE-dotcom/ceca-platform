import{a as O,r as p,R as e,L as S,s as g,c as F,i as _,b as j}from"./index-ZBnEX__d.js";function R(){const{signOut:i}=O(),[s,h]=p.useState(!1);function E(){h(!0)}function c(){h(!1)}return e.createElement(e.Fragment,null,e.createElement("button",{className:"sidebar-toggle","aria-label":"Ouvrir le menu",onClick:E},"☰"),e.createElement("div",{className:"sidebar-overlay "+(s?"show":""),onClick:c}),e.createElement("aside",{className:"admin-sidebar "+(s?"open":""),"aria-hidden":!s&&window.innerWidth<900},e.createElement("div",{className:"sidebar-brand"},e.createElement("strong",null,"CECA"),e.createElement("small",null,"Admin"),e.createElement("button",{className:"sidebar-close",onClick:c,"aria-label":"Fermer"},"×")),e.createElement("nav",{className:"sidebar-nav"},e.createElement("ul",null,e.createElement("li",null,e.createElement(S,{to:"/admin",onClick:c},"Tableau de bord")),e.createElement("li",null,e.createElement(S,{to:"/admin/formations",onClick:c},"Formations")),e.createElement("li",null,e.createElement(S,{to:"/admin/apprenants",onClick:c},"Apprenants")),e.createElement("li",null,e.createElement(S,{to:"/admin/certificats",onClick:c},"Certificats")),e.createElement("li",null,e.createElement(S,{to:"/admin/instructeurs",onClick:c},"Instructeurs")),e.createElement("li",null,e.createElement(S,{to:"/admin/parametres",onClick:c},"Paramètres")))),e.createElement("div",{className:"sidebar-footer"},e.createElement("button",{className:"btn small",onClick:async()=>{await i(),c()}},"Déconnexion"))))}const L="ceca_admin_formations";function B(){try{const i=localStorage.getItem(L);return i?JSON.parse(i):null}catch{return null}}function J(i){try{localStorage.setItem(L,JSON.stringify(i))}catch{}}function P(){const[i,s]=p.useState([]),[h,E]=p.useState(!1),[c,y]=p.useState(null),[m,N]=p.useState({title:"",category:"",duration:"",description:""}),T=!0;p.useEffect(()=>{let n=!0;async function l(){if(T&&g)try{const{data:a,error:t}=await g.from("formations").select("*").order("created_at",{ascending:!1});if(!n)return;if(t&&console.warn("Supabase formations fetch error",t),a&&Array.isArray(a)&&a.length){s(a.map(d=>({...d})));return}}catch(a){console.warn("Supabase fetch failed",a)}const u=B();u&&Array.isArray(u)&&u.length?s(u):s(F.map(a=>({...a})))}return l(),()=>{n=!1}},[]),p.useEffect(()=>{J(i)},[i]);function I(){y(null),N({title:"",category:"",duration:"",description:""}),E(!0)}function D(n){y(n.id),N({title:n.title,category:n.category,duration:n.duration,description:n.description}),E(!0)}function b(n){const{name:l,value:u}=n.target;N(a=>({...a,[l]:u}))}async function C(){if(!m.title.trim())return alert("Titre requis");if(T&&g)try{if(c){const{data:n,error:l}=await g.from("formations").update({title:m.title,category:m.category,duration:m.duration,description:m.description}).eq("id",c).select().maybeSingle();if(l)throw l;s(u=>u.map(a=>a.id===c?{...a,...n}:a))}else{const l={id:String(Date.now()),title:m.title,category:m.category,duration:m.duration,description:m.description,created_at:new Date().toISOString()},{data:u,error:a}=await g.from("formations").insert([l]).select().maybeSingle();if(a)throw a;s(t=>[u||l,...t])}E(!1);return}catch(n){console.warn("Supabase save failed",n),alert("Échec de l'enregistrement sur Supabase — bascuage en mode local")}if(c)s(n=>n.map(l=>l.id===c?{...l,...m}:l));else{const n=String(Date.now());s(l=>[{id:n,...m},...l])}E(!1)}async function k(n){if(window.confirm("Supprimer ce cours ?")){if(T&&g)try{const{error:l}=await g.from("formations").delete().eq("id",n);if(l)throw l;s(u=>u.filter(a=>a.id!==n));return}catch(l){console.warn("Supabase delete failed",l),alert("Échec de la suppression sur Supabase — bascuage en mode local")}s(l=>l.filter(u=>u.id!==n))}}return e.createElement("div",null,e.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"}},e.createElement("div",null,e.createElement("h2",null,"Formations"),e.createElement("p",{className:"muted"},"Liste des formations disponibles")),e.createElement("div",null,e.createElement("button",{className:"btn",onClick:I},"Nouveau cours"))),e.createElement("div",{style:{marginTop:12,display:"grid",gridTemplateColumns:"repeat(auto-fit,minmax(240px,1fr))",gap:12}},i.map(n=>e.createElement("div",{key:n.id,className:"card",style:{textAlign:"left"}},e.createElement("div",{style:{fontWeight:700}},n.title),e.createElement("div",{className:"muted",style:{fontSize:13}},n.category," • ",n.duration),e.createElement("div",{style:{marginTop:8,fontSize:14,color:"#333"}},n.description),e.createElement("div",{style:{marginTop:10,display:"flex",gap:8}},e.createElement(S,{to:`/formation/${n.id}`,className:"btn small"},"Voir"),e.createElement("button",{className:"btn small",onClick:()=>D(n)},"Éditer"),e.createElement("button",{className:"btn small",onClick:()=>k(n.id)},"Supprimer"))))),h&&e.createElement("div",{className:"fa-modal"},e.createElement("div",{className:"fa-modal-inner"},e.createElement("h3",null,c?"Éditer le cours":"Nouveau cours"),e.createElement("label",null,"Titre",e.createElement("label",{className:"muted"},e.createElement("input",{name:"title",value:m.title,onChange:b}))),e.createElement("label",null,"Catégorie",e.createElement("label",{className:"muted"},e.createElement("input",{name:"category",value:m.category,onChange:b}))),e.createElement("label",null,"Durée",e.createElement("label",{className:"muted"},e.createElement("input",{name:"duration",value:m.duration,onChange:b}))),e.createElement("label",null,"Description",e.createElement("label",{className:"muted"},e.createElement("textarea",{name:"description",value:m.description,onChange:b,rows:4}))),e.createElement("div",{style:{display:"flex",gap:8,marginTop:12}},e.createElement("button",{className:"btn",onClick:C},c?"Enregistrer":"Créer"),e.createElement("button",{className:"btn",onClick:()=>E(!1)},"Annuler")))))}const A="registrations",w="ceca_registrations_deleted";function W(){const[i,s]=p.useState([]),[h,E]=p.useState(!0),[c,y]=p.useState(null),[m,N]=p.useState(null),[T,I]=p.useState(null),[D,b]=p.useState(new Set),[C,k]=p.useState(null);async function n(){E(!0),y(null);try{if(_){const a=r=>{const o=String((r==null?void 0:r.message)||r||"").toLowerCase();return/could not find the table|relation ".+" does not exist|does not exist in the schema cache/.test(o)};let t=await g.from(A).select("*").order("created_at",{ascending:!1});console.debug("Supabase fetch",A,t),N({table:A,dataLength:Array.isArray(t==null?void 0:t.data)?t.data.length:null,error:(t==null?void 0:t.error)||null}),t!=null&&t.error&&!a(t.error)&&y(t.error.message||String(t.error));const d=A==="registrations"?"registration":"registrations";if(t!=null&&t.error&&a(t.error)||Array.isArray(t==null?void 0:t.data)&&t.data.length===0)try{const r=await g.from(d).select("*").order("created_at",{ascending:!1});if(console.debug("Supabase fetch alternate",d,r),!(r!=null&&r.error)&&Array.isArray(r==null?void 0:r.data)&&r.data.length>0){const o=localStorage.getItem(w),f=o?JSON.parse(o):[],v=new Set(Array.isArray(f)?f:[]);b(v),N({table:d,dataLength:r.data.length,error:null});const x=r.data.filter(z=>!v.has(z.id));s(x),E(!1);return}}catch(r){console.warn("Alternate table fetch failed",r)}if(Array.isArray(t==null?void 0:t.data)&&t.data.length>0){const r=localStorage.getItem(w),o=r?JSON.parse(r):[],f=new Set(Array.isArray(o)?o:[]);b(f);const v=t.data.filter(x=>!f.has(x.id));s(v),E(!1);return}}}catch(a){y(String(a))}try{const a=localStorage.getItem("ceca_registrations"),t=a?JSON.parse(a):[],d=localStorage.getItem(w),r=d?JSON.parse(d):[],o=new Set(Array.isArray(r)?r:[]);b(o),s(Array.isArray(t)?t.filter(f=>!o.has(f.id)):[])}catch{s([])}E(!1)}p.useEffect(()=>{n()},[]),p.useEffect(()=>{if(!_)return;const a=[];try{a.push(g.channel(`public:${A}`).on("postgres_changes",{event:"INSERT",schema:"public",table:A},t=>{const d=(t==null?void 0:t.new)??(t==null?void 0:t.record);if(!d)return;const r=localStorage.getItem(w),o=r?JSON.parse(r):[];new Set(Array.isArray(o)?o:[]).has(d.id)||s(v=>v?[d,...v]:[d])}).subscribe())}catch(t){console.warn("realtime subscribe failed",t)}return()=>{try{for(const t of a)g.removeChannel(t)}catch{}}},[_]);async function l(a){if(window.confirm("Supprimer cette inscription (local uniquement) ?")){y(null),I(a);try{const t=localStorage.getItem(w),d=t?JSON.parse(t):[],r=Array.isArray(d)?d:[];r.includes(a)||r.push(a),localStorage.setItem(w,JSON.stringify(r)),b(new Set(r));const o=(i||[]).filter(f=>f.id!==a);s(o)}catch(t){console.error("local delete failed",t),y(String(t)),window.alert("Erreur suppression locale: "+String(t))}I(null)}}function u(){if(!i||i.length===0)return;const a=["id","formation_id","formation_title","name","email","phone","organization","payment_method","notes","created_at"],t=[a.join(",")].concat(i.map(f=>a.map(v=>`"${(f[v]||"").toString().replace(/"/g,'""')}"`).join(","))).join(`
`),d=new Blob([t],{type:"text/csv;charset=utf-8;"}),r=URL.createObjectURL(d),o=document.createElement("a");o.href=r,o.download="ceca_registrations.csv",o.click(),URL.revokeObjectURL(r)}return h?e.createElement("div",{className:"admin-card"},"Chargement des apprenants…"):e.createElement("div",{className:"admin-card admin-apprenants"},c&&e.createElement("div",{style:{background:"#ffe6e6",padding:10,color:"#700",borderRadius:6,marginBottom:12}},"Erreur: ",c),e.createElement("div",{className:"admin-card-header"},e.createElement("h3",null,"Inscriptions / Apprenants"),e.createElement("div",null,e.createElement("button",{className:"btn",onClick:n},"Rafraîchir"),e.createElement("button",{className:"btn secondary",onClick:u},"Exporter CSV"))),C&&e.createElement("div",{className:"modal-backdrop",onClick:()=>k(null)},e.createElement("div",{className:"modal-card",onClick:a=>a.stopPropagation()},e.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:10}},e.createElement("h3",null,"Détails de l'inscription"),e.createElement("button",{className:"btn secondary",onClick:()=>k(null)},"Fermer")),e.createElement("div",{style:{fontSize:14,lineHeight:1.5}},Object.keys(C).map(a=>e.createElement("div",{key:a,style:{marginBottom:8}},e.createElement("strong",{style:{textTransform:"capitalize"}},a.replace(/_/g," "),":")," ",String(C[a]??"—")))))),(!i||i.length===0)&&e.createElement("div",{className:"muted"},"Aucune inscription trouvée."),e.createElement("div",{className:"apprenants-list"},(i||[]).map(a=>e.createElement("div",{className:"apprenant-row",key:a.id},e.createElement("div",{className:"apprenant-main"},e.createElement("div",{className:"apprenant-name"},a.name," ",e.createElement("span",{className:"muted"},"• ",a.email)),e.createElement("div",{className:"apprenant-meta"},"Formation: ",e.createElement("strong",null,a.formation_title)," — ",a.created_at?new Date(a.created_at).toLocaleString():"—")),e.createElement("div",{className:"apprenant-actions"},e.createElement("button",{className:"btn secondary",onClick:()=>k(a)},"Détails"),e.createElement("button",{className:"btn",onClick:()=>l(a.id)},"Supprimer"))))))}function U(){const{user:i,loading:s}=O(),E=j().pathname.replace(/^\/admin\/?/,""),c=E===""?"dashboard":E;function y(m){switch(m){case"formations":return e.createElement(P,null);case"apprenants":return e.createElement(W,null);case"certificats":return e.createElement("div",null,e.createElement("h2",null,"Certificats"),e.createElement("p",{className:"muted"},"Génération et gestion des certificats (placeholder)"),e.createElement("div",{style:{marginTop:12},className:"card"},"Aucun certificat généré — placeholder"));case"instructeurs":return e.createElement("div",null,e.createElement("h2",null,"Instructeurs"),e.createElement("p",{className:"muted"},"Liste des instructeurs (placeholder)"),e.createElement("div",{style:{marginTop:12},className:"card"},"Aucun instructeur — placeholder"));case"parametres":return e.createElement("div",null,e.createElement("h2",null,"Paramètres"),e.createElement("p",{className:"muted"},"Configuration du site (placeholder)"),e.createElement("div",{style:{marginTop:12},className:"card"},"Options de configuration — placeholder"));default:return e.createElement("div",null,e.createElement("h2",null,"Tableau de bord"),e.createElement("p",{className:"muted"},"Vue d'ensemble (placeholder)"),e.createElement("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit,minmax(200px,1fr))",gap:12,marginTop:12}},e.createElement("div",{className:"card"},"Formations: —"),e.createElement("div",{className:"card"},"Apprenants: —"),e.createElement("div",{className:"card"},"Certificats: —"),e.createElement("div",{className:"card"},"Instructeurs: —")))}}return e.createElement("section",{className:"container admin-page"},e.createElement("div",{className:"admin-layout"},e.createElement(R,null),e.createElement("main",{className:"admin-main"},e.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:12}},e.createElement("div",null,e.createElement("h1",null,"Espace administration"),e.createElement("p",{style:{marginTop:6,opacity:.9}},"Prototype de tableau de bord — aperçu professionnel pour vérification.")),e.createElement("div",{style:{textAlign:"right"}},e.createElement("div",{style:{fontSize:12,color:"#666"}},"Mode"),e.createElement("div",{style:{background:"#ffe9b3",color:"#7a4a00",padding:"6px 10px",borderRadius:6,fontWeight:600}},"Preview (no DB)"))),e.createElement("div",{style:{marginTop:18}},y(c)),e.createElement("div",{className:"admin-stats",style:{display:"grid",gridTemplateColumns:"repeat(auto-fit,minmax(180px,1fr))",gap:12,marginTop:18}},e.createElement("div",{className:"card"},e.createElement("div",{style:{fontSize:20,fontWeight:700}},"—"),e.createElement("div",{style:{fontSize:12,opacity:.7}},"Formations")),e.createElement("div",{className:"card"},e.createElement("div",{style:{fontSize:20,fontWeight:700}},"—"),e.createElement("div",{style:{fontSize:12,opacity:.7}},"Apprenants")),e.createElement("div",{className:"card"},e.createElement("div",{style:{fontSize:20,fontWeight:700}},"—"),e.createElement("div",{style:{fontSize:12,opacity:.7}},"Certificats")),e.createElement("div",{className:"card"},e.createElement("div",{style:{fontSize:20,fontWeight:700}},"—"),e.createElement("div",{style:{fontSize:12,opacity:.7}},"Instructeurs"))),e.createElement("h2",{style:{marginTop:22}},"Actions rapides"),e.createElement("div",{className:"admin-grid",style:{marginTop:10}},e.createElement("div",{className:"card"},e.createElement("div",null,e.createElement("strong",null,"Ajouter une formation"),e.createElement("div",{className:"muted"},"Formulaire d'ajout (placeholder)"),e.createElement("div",{style:{marginTop:10}},e.createElement("button",{className:"btn"},"Nouveau cours")))),e.createElement("div",{className:"card"},e.createElement("div",null,e.createElement("strong",null,"Gérer apprenants"),e.createElement("div",{className:"muted"},"Importer / Exporter (placeholder)"),e.createElement("div",{style:{marginTop:10}},e.createElement("button",{className:"btn"},"Voir la liste")))),e.createElement("div",{className:"card"},e.createElement("div",null,e.createElement("strong",null,"Générer certificats"),e.createElement("div",{className:"muted"},"Génération manuelle (placeholder)"),e.createElement("div",{style:{marginTop:10}},e.createElement("button",{className:"btn"},"Générer")))),e.createElement("div",{className:"card"},e.createElement("div",null,e.createElement("strong",null,"Paramètres"),e.createElement("div",{className:"muted"},"Configuration du site"),e.createElement("div",{style:{marginTop:10}},e.createElement("button",{className:"btn"},"Ouvrir"))))),e.createElement("div",{style:{marginTop:24,color:"#555"}},e.createElement("p",null,"Note : ceci est une interface de démonstration. Les actions sont des placeholders en attente de connexion à la base de données.")))))}export{U as default};
